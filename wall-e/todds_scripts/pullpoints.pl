#!/usr/bin/perl


##****expecting lines like this from output
##    {0: [{'c': [22.473, 53.118, 116.905], 'r': 1.381976597885342, 'b': 1}, {'c': [2.14488188976378, 6.524015748031497, 46.025590551181104], 'r': 22.118822189811244, 'b': 1}, {'c': [66.47857142857144, 62.425000000000004, 417.51785714285717], 'r': 22.475715547534318, 'b': 1}, {'c': [5.566164383561644, 2.1767123287671235, 16.014383561643836], 'r': 21.947264869856134, 'b': 1}, {'c': [-3.046979865771812, 2.6661073825503356, 39.22986577181208], 'r': 21.4206372672228, 'b': 1}, {'c': [9.468449197860963, 4.066577540106952, 31.25802139037433], 'r': 26.76632168095136, 'b': 1}, {'c': [0.7684895833333334, -0.3546875, 30.444010416666668], 'r': 21.004225818885445, 'b': 1}, {'c': [4.871041666666667, -0.3310416666666667, 24.355208333333334], 'r': 20.594851864966184, 'b': 1}, {'c': [5.258944281524926, -0.2662756598240469, 17.14149560117302], 'r': 20.716208727643576, 'b': 1}, {'c': [56.75, -44.36818181818182, 531.3863636363636], 'r': 20.65272978291924, 'b': 1}, {'c': [5.07310606060606, -1.8916666666666666, 22.141098484848484], 'r': 20.297107434148618, 'b': 1}, {'c': [8.676992753623189, -1.8505434782608696, 21.178442028985508], 'r': 20.242144179658553, 'b': 1}, {'c': [18.706481481481482, -8.5125, 54.12268518518518], 'r': 19.78086013275016, 'b': 1}, {'c': [8.5125, -31.527777777777775, 162.36805555555554], 'r': 1.4927053303604616, 'b': 1}, {'c': [12.232777777777777, -14.754999999999999, 64.94722222222222], 'r': 108.0529845505359, 'b': 1}, {'c': [60.13085106382979, -35.981914893617024, 124.36702127659575], 'r': 1.8062879984608917, 'b': 1}, {'c': [15.677187499999999, -10.49875, 36.5328125], 'r': 3.077290872499344, 'b': 1}, {'c': [15.993181818181817, -8.598484848484848, 29.521464646464647], 'r': 2.0920709679710012, 'b': 1}, {'c': [185.38333333333335, -643.1666666666667, 1948.4166666666667], 'r': 3.349690058494759, 'b': 1}, {'c': [-6.750653594771241, -16.1718954248366, 38.20424836601307], 'r': 8.676421386866044, 'b': 1}, {'c': [16.214285714285715, -13.434693877551021, 29.822704081632654], 'r': 9.053441096750236, 'b': 1}]}



my $currentinput;
my @data;
my @coords;
my $x;
my $y;
my $z;
my $r;

open INFILE, "<".$ARGV[0] or die $!;
while (<INFILE>) {
        my $currentinput = "$_";
#        @points = split("c\'\:", $currentinput);

        @data = split('\[', $currentinput);
	$frame = $data[0];
	$frame =~ s/\D//g;

	foreach my $data(@data) {
		if ($data =~ m/\,/) {
		        @coords = split('\,', $data);
			$x = $coords[0];
			$y = $coords[1];
			$z = $coords[2];
			$z =~ s/\]//g;
			$r = $coords[3];
			$r =~ s/\'r\'\: //g;
			$b = $coords[4];
			$b =~ s/\'b\'\: //g;
			$b =~ s/\}//g;
			$b =~ s/\]//g;

		}
		unless($x eq ''){
			print "$frame,$x,$y,$z,$r,$b\n";
		}
	}

}
close INFILE;



